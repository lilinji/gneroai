---
title: 生物信息学工具容器使用指南
sidebar_position: 12
description: 详细介绍HPC集群上常用生信工具容器镜像的使用方法和最佳实践
keywords: [生物信息学, Singularity, 容器, 蛋白质预测, 结构分析, GPU加速]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# 生物信息学工具容器使用指南

本指南详细介绍如何在HPC集群上使用Singularity容器运行各类生物信息学工具，涵盖蛋白质功能预测、结构分析、序列比对等多个领域的专业软件。

## 概述

### 容器技术优势

- **环境一致性** - 确保软件在不同系统上的一致运行
- **依赖管理** - 预置所有必需的库和依赖项  
- **版本控制** - 固定软件版本，保证结果可重现
- **资源隔离** - 避免不同软件间的冲突
- **GPU支持** - 支持CUDA加速的深度学习工具

### 可用工具分类

我们的集群提供了丰富的生信工具容器，主要分为以下几类：

| 分类 | 工具数量 | 主要应用场景 |
|------|----------|-------------|
| **蛋白质功能预测** | 8+ | 酶功能注释、GO预测、EC编号预测 |
| **结构预测与分析** | 6+ | 蛋白质折叠、结构优化、相互作用 |
| **序列分析** | 4+ | 序列比对、进化分析、motif识别 |
| **深度学习工具** | 5+ | 神经网络预测、大语言模型 |

## 基础使用方法

### 1. 容器环境准备

使用Singularity容器前需要加载相应模块：

```bash
# 加载Singularity模块
module load singularity

# 查看Singularity版本
singularity --version

# 查看可用容器
ls /hpcfs/fpublic/container/singularity/app/
```

### 2. 基本使用语法

Singularity的基本使用语法：

```bash
# 基本格式
singularity exec [选项] <容器文件> <命令>

# GPU加速格式  
singularity exec --nv [选项] <容器文件> <命令>

# 绑定目录格式
singularity exec --bind <主机目录>:<容器目录> <容器文件> <命令>
```

### 3. 目录和文件准备

建议的工作目录结构：

```bash
project/
├── input/                 # 输入文件
│   ├── sequences.fasta   # 序列文件
│   └── structures.pdb    # 结构文件
├── output/               # 输出结果
├── temp/                # 临时文件
├── scripts/             # 脚本文件
└── configs/             # 配置文件
```

## 蛋白质功能预测工具

### DeepEC - 深度学习酶功能预测

**功能描述：** 基于深度学习的酶功能预测工具，可预测蛋白质的EC编号

**主要特点：**
- 支持GPU加速
- 高精度酶功能预测
- 支持批量序列处理

<Tabs>
<TabItem value="basic" label="基础使用">

```bash title="DeepEC基础命令"
singularity exec --nv \
    /hpcfs/fpublic/container/singularity/app/deepec/deepec.sif \
    python /opt/deepec/deepec.py \
    -i input/sequences.fasta \
    -o output/deepec_results.txt
```

</TabItem>
<TabItem value="slurm" label="SLURM脚本">

```bash title="deepec.slurm"
#!/bin/bash
#SBATCH --job-name=deepec_job
#SBATCH --gres=gpu:1
#SBATCH --partition=qgpu_3090
#SBATCH --time=04:00:00
#SBATCH --mem=32GB

module load singularity

singularity exec --nv \
    --bind ./input:/workspace/input \
    --bind ./output:/workspace/output \
    /hpcfs/fpublic/container/singularity/app/deepec/deepec.sif \
    python /opt/deepec/deepec.py \
    -i /workspace/input/sequences.fasta \
    -o /workspace/output/deepec_results.txt
```

</TabItem>
<TabItem value="params" label="参数说明">

| 参数 | 说明 | 默认值 |
|------|------|-------|
| `-i` | 输入FASTA文件路径 | 必需 |
| `-o` | 输出结果文件路径 | 必需 |
| `--batch-size` | 批处理大小 | 32 |
| `--threshold` | 预测阈值 | 0.5 |
| `--device` | GPU设备 | cuda:0 |

</TabItem>
</Tabs>

### ECRECer - 酶反应预测

**功能描述：** 预测酶催化反应的工具

**应用场景：** 代谢途径分析、酶工程设计

```bash title="ECRECer使用示例"
singularity exec --nv \
    /hpcfs/fpublic/container/singularity/app/ecrecer/ecrecer.sif \
    python /ecrecer/production.py \
    -i input/sequences.fasta \
    -o output/ecrecer_output.tsv \
    -mode h \
    -topk 10
```

### Clean - 蛋白质序列清洗

**功能描述：** 清洗和标准化蛋白质序列数据

```bash title="Clean使用示例"
singularity exec --nv \
    /hpcfs/fpublic/container/singularity/app/clean/clean.sif \
    python /app/inference.py \
    -i input/raw_sequences.fasta \
    -o output/clean_output.tsv \
    -d temp/
```

## 结构预测与分析工具

### AlphaFold3 - 蛋白质结构预测

**功能描述：** Google DeepMind开发的最新蛋白质结构预测工具

**主要特点：**
- 支持蛋白质-配体复合物预测
- 高精度结构预测
- 支持多链结构

```bash title="AlphaFold3使用示例"
singularity exec --nv \
    -B /hpcfs/fpublic:/hpcfs/fpublic \
    sandbox_af3 \
    python /app/alphafold/run_alphafold.py \
    --json_path=input/fold_input.json \
    --model_dir=/hpcfs/fpublic/container/singularity/app/alphafold3/models/ \
    --output_dir=output/ \
    --db_dir=/hpcfs/fpublic/database/alphafold/af3/data/
```

### ESMFold - 快速结构预测

**功能描述：** Meta开发的基于语言模型的蛋白质结构预测工具

**优势：** 速度快，无需MSA，适合大规模预测

```bash title="ESMFold使用示例"
singularity exec \
    /hpcfs/fpublic/container/singularity/app/esmfold/esmfold.sif \
    bash /esmfold.sh \
    -i input/sequences.fasta \
    -o output/ \
    --cpu-only
```

### ProteinMPNN - 蛋白质设计

**功能描述：** 基于图神经网络的蛋白质序列设计工具

<Tabs>
<TabItem value="cpu" label="CPU版本">

```bash title="ProteinMPNN CPU版本"
singularity exec \
    --bind ./input/structure.pdb:/workspace/pmpnn/inputs/site.pdb \
    --bind ./output/:/tmp/results \
    pmpnn_latest.sif \
    /opt/conda/envs/ligandmpnn_env/bin/python \
    /workspace/pmpnn/run_check.py \
    --site_pdb /workspace/pmpnn/inputs/site.pdb \
    --out_dir /tmp/results
```

</TabItem>
<TabItem value="gpu" label="GPU版本">

```bash title="ProteinMPNN GPU版本"  
singularity exec --nv \
    --bind ./input/structure.pdb:/workspace/pmpnn/inputs/site.pdb \
    --bind ./output/:/tmp/results \
    pmpnn_latest.sif \
    /workspace/pmpnn/run.sh
```

</TabItem>
</Tabs>

## 序列分析工具

### ESM-1v - 进化尺度建模

**功能描述：** 基于Transformer的蛋白质语言模型，用于变异效应预测

```bash title="ESM-1v使用示例"
singularity exec --nv \
    --bind ./checkpoint/esm1v_t33_650M_UR90S_1.pt:/workspace/esm1v/esm1v_t33_650M_UR90S_1.pt \
    --bind ./input/mutations.csv:/workspace/esm1v/data/mutations.csv \
    --bind ./output/result.csv:/tmp/results/mutations_labeled.csv \
    esm1v_latest.sif \
    /bin/bash /workspace/esm1v/predict.sh "SEQUENCE_STRING" 24
```

### DeepGO2 - GO功能预测

**功能描述：** 基于深度学习的基因本体功能预测

```bash title="DeepGO2使用示例"
singularity exec \
    /hpcfs/fpublic/container/singularity/app/deepgo2/deepgo.sif \
    python /workspace/deepgo2/predict.py \
    -if input/sequences.fasta \
    --model_location /workspace/esmweight/esm2_t36_3B_UR50D.pt \
    --data-root /workspace/deepgo2/data/ \
    --out-file output/deepgo2_results.txt
```

## 高级使用技巧

### 1. GPU资源优化

```bash title="GPU内存优化"
# 设置GPU内存增长
export TF_FORCE_GPU_ALLOW_GROWTH=true

# 限制GPU内存使用
export CUDA_MEM_LIMIT=8000M

# 选择特定GPU设备
export CUDA_VISIBLE_DEVICES=0
```

### 2. 批量作业处理

```bash title="批量提交脚本"
#!/bin/bash
# 批量处理多个输入文件

TOOL_NAME="deepec"
INPUT_DIR="batch_input"
OUTPUT_DIR="batch_output"

for fasta_file in $INPUT_DIR/*.fasta; do
    basename=$(basename "$fasta_file" .fasta)
    
    sbatch --job-name="${TOOL_NAME}_${basename}" \
           --output="${OUTPUT_DIR}/${basename}.out" \
           --error="${OUTPUT_DIR}/${basename}.err" \
           run_tool.slurm "$fasta_file" "${OUTPUT_DIR}/${basename}_result.txt"
done
```

### 3. 资源监控

```bash title="监控作业资源使用"
# 查看GPU使用情况
srun --gres=gpu:1 nvidia-smi

# 监控作业状态
sstat -j $SLURM_JOB_ID --format=JobID,MaxRSS,AveCPU

# 查看详细资源使用
sacct -j $SLURM_JOB_ID --format=JobID,JobName,MaxRSS,Elapsed
```

## 故障排除

### 常见问题及解决方案

#### 1. 容器权限问题

**错误信息：** `FATAL: container creation failed: mount /proc/self/fd/3->/usr/bin`

**解决方案：**
```bash
# 使用沙箱模式
singularity shell --fakeroot container.sif

# 或者使用bind挂载
singularity exec --bind /tmp container.sif command
```

#### 2. GPU不可用

**错误信息：** `CUDA error: no CUDA-capable device is detected`

**解决方案：**
```bash
# 检查GPU分区
sinfo -p qgpu_3090

# 验证CUDA环境
module load cuda/11.8
nvidia-smi

# 在SLURM脚本中添加
#SBATCH --gres=gpu:1
```

#### 3. 内存不足

**错误信息：** `slurmstepd: error: Job exceeded memory limit`

**解决方案：**
```bash
# 增加内存申请
#SBATCH --mem=64GB

# 或使用内存优化参数
export PYTHONHASHSEED=0
export OMP_NUM_THREADS=1
```

#### 4. 文件权限问题

**错误信息：** `Permission denied` 

**解决方案：**
```bash
# 确保文件权限正确
chmod 755 input_directory/
chmod 644 input_files/*

# 或使用用户命名空间
singularity exec --userns container.sif command
```

## 最佳实践

### 1. 作业资源规划

| 工具类型 | CPU核数 | 内存 | GPU | 推荐运行时间 |
|----------|---------|------|-----|-------------|
| **小规模预测** | 4-8 | 16-32GB | 可选 | 1-4小时 |
| **中等规模** | 8-16 | 32-64GB | 推荐 | 4-12小时 |
| **大规模计算** | 16-32 | 64-128GB | 必需 | 12-24小时 |

### 2. 数据管理策略

```bash title="数据组织建议"
# 项目目录结构
project_name/
├── raw_data/           # 原始数据（只读）
├── processed_data/     # 处理后数据
├── results/           # 分析结果
│   ├── tool1/        # 按工具组织
│   └── tool2/
├── scripts/          # 分析脚本
├── configs/          # 配置文件
└── logs/            # 日志文件
```

### 3. 版本控制

```bash title="版本记录"
# 记录软件版本
echo "Tool versions:" > version_log.txt
singularity exec tool.sif tool --version >> version_log.txt

# 记录数据处理参数
echo "Parameters used:" > params_log.txt
echo "Input: $INPUT_FILE" >> params_log.txt
echo "Date: $(date)" >> params_log.txt
```

## 工具索引

### 按功能分类

<Tabs>
<TabItem value="function" label="功能预测">

| 工具名 | 主要功能 | GPU需求 | 容器路径 |
|--------|----------|---------|----------|
| **DeepEC** | EC编号预测 | 推荐 | `deepec/deepec.sif` |
| **ECRECer** | 酶反应预测 | 推荐 | `ecrecer/ecrecer.sif` |
| **Clean** | 序列清洗 | 推荐 | `clean/clean.sif` |
| **CATFam** | 蛋白质家族 | 否 | `catfam/catfam.sif` |
| **PRIAM** | 酶功能分类 | 否 | `priam/priam.sif` |
| **ECPred** | EC预测 | 否 | `ecpred/ecpred.sif` |
| **DeepGO2** | GO预测 | 否 | `deepgo2/deepgo.sif` |

</TabItem>
<TabItem value="structure" label="结构分析">

| 工具名 | 主要功能 | GPU需求 | 容器路径 |
|--------|----------|---------|----------|
| **AlphaFold3** | 结构预测 | 必需 | `alphafold3/` |
| **ESMFold** | 快速折叠 | 可选 | `esmfold/esmfold.sif` |
| **ProteinMPNN** | 序列设计 | 推荐 | `pmpnn_latest.sif` |
| **ESM-IF1** | 逆向折叠 | 必需 | `esm-if_latest.sif` |
| **DeepFRI** | 功能结构 | 可选 | `deepfri_cpu_sandbox/` |

</TabItem>
<TabItem value="ml" label="机器学习">

| 工具名 | 主要功能 | GPU需求 | 容器路径 |
|--------|----------|---------|----------|
| **ESM-1v** | 变异预测 | 必需 | `esm1v_latest.sif` |
| **DHR** | 同源检索 | 否 | `dhr_latest.sif` |
| **MPEPE** | 表达预测 | 可选 | `mpepe_latest.sif` |
| **Vector** | 大语言模型 | 必需 | 参考文档 |

</TabItem>
</Tabs>

## 参考资源

- **容器路径：** `/hpcfs/fpublic/container/singularity/app/`
- **数据库路径：** `/hpcfs/fpublic/database/`
- **脚本模板：** 位于 `/static/guides/hpc/bioinformatics/scripts/` 目录
- **配置示例：** 位于 `/static/guides/hpc/bioinformatics/configs/` 目录
- **Singularity官方文档：** [https://sylabs.io/docs/](https://sylabs.io/docs/)

---

<head>
  <title>生物信息学工具容器使用指南 | HPC文档</title>
  <meta
    name="description"
    content="详细介绍HPC集群上常用生信工具容器镜像的使用方法，包括蛋白质功能预测、结构分析、深度学习工具等完整使用指南。"
  />
  <meta
    name="keywords"
    content="生物信息学, Singularity, 容器, 蛋白质预测, 结构分析, GPU加速, DeepEC, AlphaFold3, ESMFold"
  />
</head> 